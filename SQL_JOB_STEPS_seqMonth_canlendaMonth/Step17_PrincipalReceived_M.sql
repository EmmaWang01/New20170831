
if OBJECT_ID('zz_PrincipalReceived_M') is not null
drop table zz_PrincipalReceived_M

select 
	t1.[LoanNo],
	t1.[Client],
	t1.[SettleDate],
	t1.[Prod_Status],
	t1.[Prod Type],
	t1.[Term],
	t1.[Initial Freq],
	t1.[Initial Repayment Amnt],
	t1.[OStd Balance],
	t1.[Total Cashout],
	t1.[Cash Out],
	t1.[Insurance],
	t1.[Brokerage],
	t1.[Establish Fee],
	t1.[Draw Down],
	t1.[Application Fee],
	t1.[Fees Charged],
	t1.[DrawDown Fee],
	t1.[Interest Charged],
	t1.[Total Received],
	t1.[Total Net Received],
	t1.[Dishonoured],
	t1.[DishonCnt],
	t1.[Last Success Payment Date],
	t1.[Loss Date],
	IIF((isnull(t1.M0,0)-isnull(t2.M0,0)-isnull(t3.M0,0))>0, (isnull(t1.M0,0)-isnull(t2.M0,0)-isnull(t3.M0,0)),0) As M0,
	IIF((isnull(t1.M1,0)-isnull(t2.M1,0)-isnull(t3.M1,0))>0, (isnull(t1.M1,0)-isnull(t2.M1,0)-isnull(t3.M1,0)),0) As M1,
	IIF((isnull(t1.M2,0)-isnull(t2.M2,0)-isnull(t3.M2,0))>0, (isnull(t1.M2,0)-isnull(t2.M2,0)-isnull(t3.M2,0)),0) As M2,
	IIF((isnull(t1.M3,0)-isnull(t2.M3,0)-isnull(t3.M3,0))>0, (isnull(t1.M3,0)-isnull(t2.M3,0)-isnull(t3.M3,0)),0) As M3,
	IIF((isnull(t1.M4,0)-isnull(t2.M4,0)-isnull(t3.M4,0))>0, (isnull(t1.M4,0)-isnull(t2.M4,0)-isnull(t3.M4,0)),0) As M4,
	IIF((isnull(t1.M5,0)-isnull(t2.M5,0)-isnull(t3.M5,0))>0, (isnull(t1.M5,0)-isnull(t2.M5,0)-isnull(t3.M5,0)),0) As M5,
	IIF((isnull(t1.M6,0)-isnull(t2.M6,0)-isnull(t3.M6,0))>0, (isnull(t1.M6,0)-isnull(t2.M6,0)-isnull(t3.M6,0)),0) As M6,
	IIF((isnull(t1.M7,0)-isnull(t2.M7,0)-isnull(t3.M7,0))>0, (isnull(t1.M7,0)-isnull(t2.M7,0)-isnull(t3.M7,0)),0) As M7,
	IIF((isnull(t1.M8,0)-isnull(t2.M8,0)-isnull(t3.M8,0))>0, (isnull(t1.M8,0)-isnull(t2.M8,0)-isnull(t3.M8,0)),0) As M8,
	IIF((isnull(t1.M9,0)-isnull(t2.M9,0)-isnull(t3.M9,0))>0, (isnull(t1.M9,0)-isnull(t2.M9,0)-isnull(t3.M9,0)),0) As M9,
	IIF((isnull(t1.M10,0)-isnull(t2.M10,0)-isnull(t3.M10,0))>0, (isnull(t1.M10,0)-isnull(t2.M10,0)-isnull(t3.M10,0)),0) As M10,
	IIF((isnull(t1.M11,0)-isnull(t2.M11,0)-isnull(t3.M11,0))>0, (isnull(t1.M11,0)-isnull(t2.M11,0)-isnull(t3.M11,0)),0) As M11,
	IIF((isnull(t1.M12,0)-isnull(t2.M12,0)-isnull(t3.M12,0))>0, (isnull(t1.M12,0)-isnull(t2.M12,0)-isnull(t3.M12,0)),0) As M12,
	IIF((isnull(t1.M13,0)-isnull(t2.M13,0)-isnull(t3.M13,0))>0, (isnull(t1.M13,0)-isnull(t2.M13,0)-isnull(t3.M13,0)),0) As M13,
	IIF((isnull(t1.M14,0)-isnull(t2.M14,0)-isnull(t3.M14,0))>0, (isnull(t1.M14,0)-isnull(t2.M14,0)-isnull(t3.M14,0)),0) As M14,
	IIF((isnull(t1.M15,0)-isnull(t2.M15,0)-isnull(t3.M15,0))>0, (isnull(t1.M15,0)-isnull(t2.M15,0)-isnull(t3.M15,0)),0) As M15,
	IIF((isnull(t1.M16,0)-isnull(t2.M16,0)-isnull(t3.M16,0))>0, (isnull(t1.M16,0)-isnull(t2.M16,0)-isnull(t3.M16,0)),0) As M16,
	IIF((isnull(t1.M17,0)-isnull(t2.M17,0)-isnull(t3.M17,0))>0, (isnull(t1.M17,0)-isnull(t2.M17,0)-isnull(t3.M17,0)),0) As M17,
	IIF((isnull(t1.M18,0)-isnull(t2.M18,0)-isnull(t3.M18,0))>0, (isnull(t1.M18,0)-isnull(t2.M18,0)-isnull(t3.M18,0)),0) As M18,
	IIF((isnull(t1.M19,0)-isnull(t2.M19,0)-isnull(t3.M19,0))>0, (isnull(t1.M19,0)-isnull(t2.M19,0)-isnull(t3.M19,0)),0) As M19,
	IIF((isnull(t1.M20,0)-isnull(t2.M20,0)-isnull(t3.M20,0))>0, (isnull(t1.M20,0)-isnull(t2.M20,0)-isnull(t3.M20,0)),0) As M20,
	IIF((isnull(t1.M21,0)-isnull(t2.M21,0)-isnull(t3.M21,0))>0, (isnull(t1.M21,0)-isnull(t2.M21,0)-isnull(t3.M21,0)),0) As M21,
	IIF((isnull(t1.M22,0)-isnull(t2.M22,0)-isnull(t3.M22,0))>0, (isnull(t1.M22,0)-isnull(t2.M22,0)-isnull(t3.M22,0)),0) As M22,
	IIF((isnull(t1.M23,0)-isnull(t2.M23,0)-isnull(t3.M23,0))>0, (isnull(t1.M23,0)-isnull(t2.M23,0)-isnull(t3.M23,0)),0) As M23,
	IIF((isnull(t1.M24,0)-isnull(t2.M24,0)-isnull(t3.M24,0))>0, (isnull(t1.M24,0)-isnull(t2.M24,0)-isnull(t3.M24,0)),0) As M24,
	IIF((isnull(t1.M25,0)-isnull(t2.M25,0)-isnull(t3.M25,0))>0, (isnull(t1.M25,0)-isnull(t2.M25,0)-isnull(t3.M25,0)),0) As M25,
	IIF((isnull(t1.M26,0)-isnull(t2.M26,0)-isnull(t3.M26,0))>0, (isnull(t1.M26,0)-isnull(t2.M26,0)-isnull(t3.M26,0)),0) As M26,
	IIF((isnull(t1.M27,0)-isnull(t2.M27,0)-isnull(t3.M27,0))>0, (isnull(t1.M27,0)-isnull(t2.M27,0)-isnull(t3.M27,0)),0) As M27,
	IIF((isnull(t1.M28,0)-isnull(t2.M28,0)-isnull(t3.M28,0))>0, (isnull(t1.M28,0)-isnull(t2.M28,0)-isnull(t3.M28,0)),0) As M28,
	IIF((isnull(t1.M29,0)-isnull(t2.M29,0)-isnull(t3.M29,0))>0, (isnull(t1.M29,0)-isnull(t2.M29,0)-isnull(t3.M29,0)),0) As M29,
	IIF((isnull(t1.M30,0)-isnull(t2.M30,0)-isnull(t3.M30,0))>0, (isnull(t1.M30,0)-isnull(t2.M30,0)-isnull(t3.M30,0)),0) As M30,
	IIF((isnull(t1.M31,0)-isnull(t2.M31,0)-isnull(t3.M31,0))>0, (isnull(t1.M31,0)-isnull(t2.M31,0)-isnull(t3.M31,0)),0) As M31,
	IIF((isnull(t1.M32,0)-isnull(t2.M32,0)-isnull(t3.M32,0))>0, (isnull(t1.M32,0)-isnull(t2.M32,0)-isnull(t3.M32,0)),0) As M32,
	IIF((isnull(t1.M33,0)-isnull(t2.M33,0)-isnull(t3.M33,0))>0, (isnull(t1.M33,0)-isnull(t2.M33,0)-isnull(t3.M33,0)),0) As M33,
	IIF((isnull(t1.M34,0)-isnull(t2.M34,0)-isnull(t3.M34,0))>0, (isnull(t1.M34,0)-isnull(t2.M34,0)-isnull(t3.M34,0)),0) As M34,
	IIF((isnull(t1.M35,0)-isnull(t2.M35,0)-isnull(t3.M35,0))>0, (isnull(t1.M35,0)-isnull(t2.M35,0)-isnull(t3.M35,0)),0) As M35,
	IIF((isnull(t1.M36,0)-isnull(t2.M36,0)-isnull(t3.M36,0))>0, (isnull(t1.M36,0)-isnull(t2.M36,0)-isnull(t3.M36,0)),0) As M36,
	IIF((isnull(t1.M37,0)-isnull(t2.M37,0)-isnull(t3.M37,0))>0, (isnull(t1.M37,0)-isnull(t2.M37,0)-isnull(t3.M37,0)),0) As M37,
	IIF((isnull(t1.M38,0)-isnull(t2.M38,0)-isnull(t3.M38,0))>0, (isnull(t1.M38,0)-isnull(t2.M38,0)-isnull(t3.M38,0)),0) As M38,
	IIF((isnull(t1.M39,0)-isnull(t2.M39,0)-isnull(t3.M39,0))>0, (isnull(t1.M39,0)-isnull(t2.M39,0)-isnull(t3.M39,0)),0) As M39,
	IIF((isnull(t1.M40,0)-isnull(t2.M40,0)-isnull(t3.M40,0))>0, (isnull(t1.M40,0)-isnull(t2.M40,0)-isnull(t3.M40,0)),0) As M40,
	IIF((isnull(t1.M41,0)-isnull(t2.M41,0)-isnull(t3.M41,0))>0, (isnull(t1.M41,0)-isnull(t2.M41,0)-isnull(t3.M41,0)),0) As M41,
	IIF((isnull(t1.M42,0)-isnull(t2.M42,0)-isnull(t3.M42,0))>0, (isnull(t1.M42,0)-isnull(t2.M42,0)-isnull(t3.M42,0)),0) As M42,
	IIF((isnull(t1.M43,0)-isnull(t2.M43,0)-isnull(t3.M43,0))>0, (isnull(t1.M43,0)-isnull(t2.M43,0)-isnull(t3.M43,0)),0) As M43,
	IIF((isnull(t1.M44,0)-isnull(t2.M44,0)-isnull(t3.M44,0))>0, (isnull(t1.M44,0)-isnull(t2.M44,0)-isnull(t3.M44,0)),0) As M44,
	IIF((isnull(t1.M45,0)-isnull(t2.M45,0)-isnull(t3.M45,0))>0, (isnull(t1.M45,0)-isnull(t2.M45,0)-isnull(t3.M45,0)),0) As M45,
	IIF((isnull(t1.M46,0)-isnull(t2.M46,0)-isnull(t3.M46,0))>0, (isnull(t1.M46,0)-isnull(t2.M46,0)-isnull(t3.M46,0)),0) As M46,
	IIF((isnull(t1.M47,0)-isnull(t2.M47,0)-isnull(t3.M47,0))>0, (isnull(t1.M47,0)-isnull(t2.M47,0)-isnull(t3.M47,0)),0) As M47,
	IIF((isnull(t1.M48,0)-isnull(t2.M48,0)-isnull(t3.M48,0))>0, (isnull(t1.M48,0)-isnull(t2.M48,0)-isnull(t3.M48,0)),0) As M48,
	IIF((isnull(t1.M49,0)-isnull(t2.M49,0)-isnull(t3.M49,0))>0, (isnull(t1.M49,0)-isnull(t2.M49,0)-isnull(t3.M49,0)),0) As M49,
	IIF((isnull(t1.M50,0)-isnull(t2.M50,0)-isnull(t3.M50,0))>0, (isnull(t1.M50,0)-isnull(t2.M50,0)-isnull(t3.M50,0)),0) As M50,
	IIF((isnull(t1.M51,0)-isnull(t2.M51,0)-isnull(t3.M51,0))>0, (isnull(t1.M51,0)-isnull(t2.M51,0)-isnull(t3.M51,0)),0) As M51,
	IIF((isnull(t1.M52,0)-isnull(t2.M52,0)-isnull(t3.M52,0))>0, (isnull(t1.M52,0)-isnull(t2.M52,0)-isnull(t3.M52,0)),0) As M52,
	IIF((isnull(t1.M53,0)-isnull(t2.M53,0)-isnull(t3.M53,0))>0, (isnull(t1.M53,0)-isnull(t2.M53,0)-isnull(t3.M53,0)),0) As M53,
	IIF((isnull(t1.M54,0)-isnull(t2.M54,0)-isnull(t3.M54,0))>0, (isnull(t1.M54,0)-isnull(t2.M54,0)-isnull(t3.M54,0)),0) As M54,
	IIF((isnull(t1.M55,0)-isnull(t2.M55,0)-isnull(t3.M55,0))>0, (isnull(t1.M55,0)-isnull(t2.M55,0)-isnull(t3.M55,0)),0) As M55,
	IIF((isnull(t1.M56,0)-isnull(t2.M56,0)-isnull(t3.M56,0))>0, (isnull(t1.M56,0)-isnull(t2.M56,0)-isnull(t3.M56,0)),0) As M56,
	IIF((isnull(t1.M57,0)-isnull(t2.M57,0)-isnull(t3.M57,0))>0, (isnull(t1.M57,0)-isnull(t2.M57,0)-isnull(t3.M57,0)),0) As M57,
	IIF((isnull(t1.M58,0)-isnull(t2.M58,0)-isnull(t3.M58,0))>0, (isnull(t1.M58,0)-isnull(t2.M58,0)-isnull(t3.M58,0)),0) As M58,
	IIF((isnull(t1.M59,0)-isnull(t2.M59,0)-isnull(t3.M59,0))>0, (isnull(t1.M59,0)-isnull(t2.M59,0)-isnull(t3.M59,0)),0) As M59,
	IIF((isnull(t1.M60,0)-isnull(t2.M60,0)-isnull(t3.M60,0))>0, (isnull(t1.M60,0)-isnull(t2.M60,0)-isnull(t3.M60,0)),0) As M60,
	IIF((isnull(t1.M61,0)-isnull(t2.M61,0)-isnull(t3.M61,0))>0, (isnull(t1.M61,0)-isnull(t2.M61,0)-isnull(t3.M61,0)),0) As M61,
	IIF((isnull(t1.M62,0)-isnull(t2.M62,0)-isnull(t3.M62,0))>0, (isnull(t1.M62,0)-isnull(t2.M62,0)-isnull(t3.M62,0)),0) As M62,
	IIF((isnull(t1.M63,0)-isnull(t2.M63,0)-isnull(t3.M63,0))>0, (isnull(t1.M63,0)-isnull(t2.M63,0)-isnull(t3.M63,0)),0) As M63,
	IIF((isnull(t1.M64,0)-isnull(t2.M64,0)-isnull(t3.M64,0))>0, (isnull(t1.M64,0)-isnull(t2.M64,0)-isnull(t3.M64,0)),0) As M64,
	IIF((isnull(t1.M65,0)-isnull(t2.M65,0)-isnull(t3.M65,0))>0, (isnull(t1.M65,0)-isnull(t2.M65,0)-isnull(t3.M65,0)),0) As M65,
	IIF((isnull(t1.M66,0)-isnull(t2.M66,0)-isnull(t3.M66,0))>0, (isnull(t1.M66,0)-isnull(t2.M66,0)-isnull(t3.M66,0)),0) As M66,
	IIF((isnull(t1.M67,0)-isnull(t2.M67,0)-isnull(t3.M67,0))>0, (isnull(t1.M67,0)-isnull(t2.M67,0)-isnull(t3.M67,0)),0) As M67,
	IIF((isnull(t1.M68,0)-isnull(t2.M68,0)-isnull(t3.M68,0))>0, (isnull(t1.M68,0)-isnull(t2.M68,0)-isnull(t3.M68,0)),0) As M68,
	IIF((isnull(t1.M69,0)-isnull(t2.M69,0)-isnull(t3.M69,0))>0, (isnull(t1.M69,0)-isnull(t2.M69,0)-isnull(t3.M69,0)),0) As M69,
	IIF((isnull(t1.M70,0)-isnull(t2.M70,0)-isnull(t3.M70,0))>0, (isnull(t1.M70,0)-isnull(t2.M70,0)-isnull(t3.M70,0)),0) As M70,
	IIF((isnull(t1.M71,0)-isnull(t2.M71,0)-isnull(t3.M71,0))>0, (isnull(t1.M71,0)-isnull(t2.M71,0)-isnull(t3.M71,0)),0) As M71,
	IIF((isnull(t1.M72,0)-isnull(t2.M72,0)-isnull(t3.M72,0))>0, (isnull(t1.M72,0)-isnull(t2.M72,0)-isnull(t3.M72,0)),0) As M72

into zz_PrincipalReceived_M
from zz_NetReceivedOutput_M as t1
left join zz_FeesReceivedOutput_M as t2 on t1.LoanNo = t2.Loanno
left join zz_InterestReceivedOutput_M as t3 on t1.Loanno=t3.LoanNo
--where t1.LoanNo=6



/*select * from zz_NetReceivedOutput_M where LoanNo=6
select * from zz_FeesReceivedOutput_M where LoanNo=6
select * from zz_InterestReceivedOutput_M where LoanNo=6*/

-- select * from zz_PrincipalReceived_M